!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=1)}([function(e,n,t){"use strict";n.__esModule=!0;firebase.initializeApp({apiKey:"AIzaSyADRNdtiNW1U6g4lKP5ppRuTS1M-i7sHqM",authDomain:"trading-d0033.firebaseapp.com",databaseURL:"https://trading-d0033.firebaseio.com",projectId:"trading-d0033",storageBucket:"trading-d0033.appspot.com",messagingSenderId:"53842051804",appId:"1:53842051804:web:bbfaa92e1dcc3edc72aa19"});var o=firebase.auth();n.auth=o;var r=firebase.firestore();n.db=r;var a=firebase.functions();n.functions=a,console.log(o)},function(e,n,t){"use strict";n.__esModule=!0;var o=t(0),r=document.querySelector(".start"),a=document.querySelector(".auth"),s=document.querySelector(".signup"),i=document.querySelector(".login"),c=document.querySelector(".game-control"),u=document.querySelector('input[type="range"]'),l=document.querySelector("nav"),d=document.querySelector(".main"),f=document.querySelector(".result"),m=document.querySelector(".account"),p=document.querySelector(".logout-confirmed"),v=document.querySelector(".join-game"),h=document.querySelector(".join-form"),b=document.querySelector(".display");s.addEventListener("click",(function(){w.signup()})),i.addEventListener("click",(function(){w.login()}));var g=function(e){Array.from(document.querySelector(".white-cards").children).forEach((function(e){e.classList.add("d-none")})),e.classList.remove("d-none")};document.querySelector(".home-btn").addEventListener("click",(function(){g(v)})),document.querySelector(".add-admin").addEventListener("click",(function(){g(document.querySelector(".add-admin-form"))})),document.querySelector(".new-session").addEventListener("click",(function(e){e.preventDefault();c.innerHTML='\n    <form class="init-session">\n      <div class="form-group">\n        <label for="sessionId">Give the session an id:</label>\n        <input type="text" class="form-control" id="sessionId" placeholder="Session id" autocomplete="off" required>\n      </div>\n      <div class="form-group">\n        <label for="stock">Type in the name of the stock:</label>\n        <input type="text" class="form-control" id="stock" placeholder="Stock name"autocomplete="off" required>\n      </div>\n      <button type="submit" class="btn btn-dark">Submit</button>\n    </form>\n  ';var n,t=document.querySelector(".init-session");t.addEventListener("submit",(function(e){e.preventDefault(),localStorage.lastChartVal=0,n=t.sessionId.value.trim(),k.newSession({id:n,stockName:t.stock.value}).then((function(){c.innerHTML='\n        <div class="text-center content-div">\n          <span style="color: lime; font-size: 2em; font-weight: bold">&#10003;</span><br>\n          <span>Success! Now share the id with your friends.</span>\n        </div>\n        <div class="text-center">\n          <button class="next btn btn-dark" style="margin-top: 20px;">next</button>\n        <div>\n      ';var e=document.querySelector(".content-div"),t=document.querySelector(".next");t.onclick=function(){setTimeout((function(){return t.blur()}),50),e.innerHTML="\n          <h1>"+n+"</h1>\n        ",t.onclick=y}})).catch((function(e){console.log(e),console.log("newSession has failed"),alert("There was an error: view console")}))})),g(c)}));var y=function(){o.db.collection("users").doc(o.auth.currentUser.uid).get().then((function(e){localStorage.currentSessionOfAdmin=e.data().currentSession,o.db.collection("sessions").doc(localStorage.currentSessionOfAdmin).get().then((function(n){c.innerHTML='\n            <small class="text-muted" style="letter-spacing: 1.1px; float: left">\n              Session id:  '+e.data().currentSession+'\n            </small>\n            <small class="text-muted" style="letter-spacing: 1.1px; float: right">\n              Stock: '+n.data().stock+'\n            </small>\n\n            <form class="add-value" style="margin-top: 35px">\n              <div class="form-group">\n                <label for="sessionId">New value:</label>\n                <div class="input-group">\n                  <input type="text" class="form-control" id="value" placeholder="value" autocomplete="off" required>\n                  <div class="input-group-append">\n                    <button type="submit" class="btn btn-dark">Submit</button>\n                  </div>\n                </div>\n              </div>\n              <button type="button" class="btn btn-dark block">Block all users</button>\n              <button type="button" class="btn btn-dark" style="float: right" data-toggle="modal" data-target="#endSessionModal">End session</button>\n            </form>\n          ';var t=new Set;o.db.collection("users").where("currentSession","==",localStorage.currentSessionOfAdmin).where("occupiedAsAdmin","==",!1).onSnapshot((function(e){e.docs.forEach((function(e){t.add(e.id)})),localStorage.setItem("userList",JSON.stringify(t))})),document.querySelector(".session-end-confirmed").addEventListener("click",(function(){k.endSession({id:e.data().currentSession}).then((function(){g(v)}))})),document.querySelector(".block").addEventListener("click",(function(){t.forEach((function(e){k.disable(e)}))}));var r=document.querySelector(".add-value");r.addEventListener("submit",(function(e){e.preventDefault();var n=Number(r.value.value.trim())-Number(localStorage.lastChartVal);localStorage.lastChartVal=r.value.value,r.value.value="",k.updateIndividualResults(t,n).then((function(e){console.table(e),k.updateRanking(e)})).catch((function(e){console.log("updateIndividualResults has failed"),console.log(e)}))}))})).catch((function(e){console.log("getting firestore rankings has failed in main.ts"),console.log(e)}))}))};h.addEventListener("submit",(function(e){e.preventDefault(),localStorage.currentSessionOfUser=h.enter.value.trim(),S(localStorage.currentSessionOfUser,0)}));var S=function(e,n){var t;o.db.collection("sessions").doc(e).get().then((function(a){if(a.data())if(a.data().isLive){if(e){o.db.collection("users").doc(o.auth.currentUser.uid).get().then((function(r){r.data()[r.data().currentSession]?f.innerText="$"+r.data()[r.data().currentSession]:f.innerText="$0",k.joinGame({session:e,canAddValues:r.data().canAddValues}).then((function(){v.classList.add("d-none"),d.classList.remove("d-none"),localStorage.rangeVal=n,u.value=String(n),b.innerText=String(n),r.data().canAddValues||u.setAttribute("disabled","true");var e=function(){b.classList.remove("btn","btn-dark","text-muted"),b.classList.add("font-weight-bold")};u.addEventListener("mousedown",(function(){b.classList.add("text-muted"),b.classList.remove("btn","btn-dark","font-weight-bold")})),u.addEventListener("input",(function(){b.classList.remove("d-none"),b.innerText=u.value})),u.addEventListener("mouseup",(function(){localStorage.rangeVal==u.value?e():(b.classList.remove("text-muted"),b.classList.add("btn","btn-dark"))})),t=function(){u.removeAttribute("disabled")},r.data().canAddValues&&t(),b.addEventListener("click",(function(){b.classList.contains("btn")&&(localStorage.rangeVal=u.value,e(),k.addUserValue({id:localStorage.currentSessionOfUser,value:Number(u.value)}))})),u.addEventListener("touchstart",(function(){b.classList.add("text-muted"),b.classList.remove("btn","btn-dark","font-weight-bold")})),u.addEventListener("touchend",(function(){localStorage.rangeVal==u.value?e():(b.classList.remove("text-muted"),b.classList.add("btn","btn-dark"))}))})),o.db.collection("rankings").doc(a.id).onSnapshot((function(e){var n=document.querySelector(".rankings-list"),t=Object.keys(e.data()).sort((function(n,t){return e.data()[t]-e.data()[n]}));n.innerHTML="",t.forEach((function(t,o){var a=t===r.data().username?"you":"";n.innerHTML+='\n\n                            <li class="list-group-item '+a+'">\n\n                              <span class="ranking">'+(o+1)+'</span>\n\n                              <div class="info">\n                                <p>'+t+'</p>\n                                <small class="text-muted">$'+e.data()[t]+"</small>\n                              </div>\n\n                        "})),document.querySelector(".you").scrollIntoView()}))})).catch((function(e){return console.log(e)}));var s=!1,i=o.db.collection("users").doc(o.auth.currentUser.uid).onSnapshot((function(e){!e.data().currentSession&&s&&(alert("the session has ended"),g(v),setTimeout(i,1e3)),s=!0,r&&(f.innerText=e.data()[e.data().currentSession]?"$"+e.data()[e.data().currentSession]:"$0",e.data().canAddValues?t():u.setAttribute("disabled","true")),r=!0}))}}else g(v),alert("the session has ended");else g(v),alert("there is no such session")}));var r=!1};t(2);var w=new(t(3).default)(a),k=new(t(4).default),L=function(e){w.addAdminCloudFunction(document.querySelector(".add-admin-form"),(function(){g(v)})),o.db.collection("users").doc(o.auth.currentUser.uid).get().then((function(n){m.innerHTML="\n        <span>Your email address: '"+e.email+"'</span><br>\n        <span>Your name: '"+n.data().username+'\'</span><br>\n        <span class="admin">You are an admin</span>\n        <p><small class="text-muted">Unfortunately, you can\'t edit your account yet.</small></p>\n      ',e.admin?document.querySelectorAll(".admin").forEach((function(e){e.classList.remove("d-none")})):document.querySelectorAll(".admin").forEach((function(e){e.classList.add("d-none")})),l.classList.remove("d-none"),r.classList.add("d-none"),n.data().currentSession&&n.data().occupiedAsAdmin?(y(),g(c)):n.data().currentSession&&!n.data().occupiedAsAdmin?S(n.data().currentSession,localStorage.rangeVal):(g(v),h.enter.focus())})),p.addEventListener("click",(function(){o.auth.signOut(),l.classList.add("d-none"),g(r)}))};w.listener((function(e){o.db.collection("users").doc(e.uid).get().then((function(n){var t=function(){a.innerHTML='\n        <form class="nameForm">\n          <div class="form-group">\n            <label for="name">Type in a nickname:</label>\n            <input type="text" class="form-control" id="nameInput" placeholder="nickname">\n          </div>\n          <button type="submit" class="btn btn-dark">Submit</button>\n        </form>\n        ',a.classList.remove("d-none");var n=document.querySelector(".nameForm");n.addEventListener("submit",(function(t){t.preventDefault(),o.db.collection("users").doc(e.uid).set({username:n.nameInput.value.trim(),currentSession:"",occupiedAsAdmin:!1,canAddValues:!1}).then((function(){L(e)})).catch((function(e){return console.log(e)}))}))};n.data()?(n.data().username||t(),L(e)):(t(),o.db.collection("users").doc(o.auth.currentUser.uid).get().then((function(){L(e)})))}))}))},function(e,n,t){"use strict";n.__esModule=!0;var o=document.querySelector(".settings-btn"),r=document.querySelector(".settings"),a=document.querySelector(".theme-form"),s=localStorage.theme?localStorage.theme:"default";document.querySelector(".theme").setAttribute("href","styles/"+s+".css");var i=document.querySelectorAll(".themeButton");switch(s){case"default":a.default.setAttribute("checked","checked"),i.forEach((function(e){e.classList.add("btn-dark")}));break;case"dark":a.dark.setAttribute("checked","checked"),i.forEach((function(e){e.classList.add("btn-light")}));break;default:a.default.setAttribute("checked","checked")}o.addEventListener("click",(function(){Array.from(document.querySelector(".white-cards").children).forEach((function(e){e.classList.add("d-none")})),r.classList.remove("d-none"),console.log(s),a.addEventListener("change",(function(){console.log(a.theme.value),localStorage.theme=a.theme.value,window.location.reload(!1)}))})),n.default={}},function(e,n,t){"use strict";n.__esModule=!0;var o=t(0),r=function(){function e(e){this.div=e}return e.prototype.addAdminCloudFunction=function(e,n){e.addEventListener("submit",(function(t){t.preventDefault();var r=e.email.value;o.functions.httpsCallable("addAdminRole")({email:r}).then((function(e){console.log(e),n()})).catch((function(e){console.log(e),alert("There was an error: view console")}))}))},e.prototype.signup=function(){var e=this;this.div.innerHTML='\n    <form class="signup-form">\n      <div class="form-group">\n        <label for="inputEmail">Email address</label>\n        <input type="email" class="form-control" id="inputEmail" aria-describedby="emailHelp" placeholder="Enter email" required>\n        <small id="emailHelp" class="form-text text-muted">Please DON\'T use your school email-address to sign up.</small>\n      </div>\n      <div class="form-group">\n        <label for="inputPassword">Password</label>\n        <input type="password" class="form-control" id="inputPassword" placeholder="Password" required>\n        <small id="emailHelp" class="form-text text-muted">Your password is safe here - not even I can possibly view it.</small>\n      </div>\n      <div class="form-group">\n        <label for="confirmPassword">Confirm Password</label>\n        <input type="password" class="form-control" id="confirmPassword" placeholder="Password" required>\n      </div>\n      <button type="submit" class="btn btn-dark">Submit</button>\n    </form>\n    <div class="error text-danger d-none"></div>\n    ';var n=document.querySelector(".signup-form"),t=n.inputEmail,r=n.inputPassword,a=n.confirmPassword,s=document.querySelector(".error");t.focus(),n.addEventListener("submit",(function(n){n.preventDefault(),r.value===a.value?(e.div.classList.add("d-none"),o.auth.createUserWithEmailAndPassword(t.value,r.value).catch((function(e){s.textContent=e,s.classList.remove("d-none")}))):(a.value="",s.innerHTML="Password and Confirm Password are not the same")}))},e.prototype.login=function(){this.div.innerHTML='\n      <form class="login-form">\n        <div class="form-group">\n          <label for="exampleInputEmail1">Email address</label>\n          <input type="email" class="form-control" id="inputEmail" aria-describedby="emailHelp" placeholder="Enter email" required>\n        </div>\n        <div class="form-group">\n          <label for="exampleInputPassword1">Password</label>\n          <input type="password" class="form-control" id="inputPassword" placeholder="Password" required>\n        </div>\n        <button type="submit" class="btn btn-dark">Submit</button>\n      </form>\n      <div class="error text-danger d-none"></div>\n    ';var e=document.querySelector(".login-form"),n=e.inputEmail,t=e.inputPassword,r=document.querySelector(".error");n.focus(),e.addEventListener("submit",(function(e){e.preventDefault(),o.auth.signInWithEmailAndPassword(n.value,t.value).catch((function(e){r.textContent=e,r.classList.remove("d-none")}))}))},e.prototype.listener=function(e){var n=this;o.auth.onAuthStateChanged((function(t){t?t.getIdTokenResult().then((function(n){t.admin=n.claims.admin,e(t)})):(n.div.innerHTML="",n.user=void 0)}))},e}();n.default=r},function(e,n,t){"use strict";var o=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function s(e){try{c(o.next(e))}catch(e){a(e)}}function i(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,i)}c((o=o.apply(e,n||[])).next())}))},r=this&&this.__generator||function(e,n){var t,o,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(e,s)}catch(e){a=[6,e],o=0}finally{t=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}},a=this&&this.__spreadArrays||function(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;var o=Array(e),r=0;for(n=0;n<t;n++)for(var a=arguments[n],s=0,i=a.length;s<i;s++,r++)o[r]=a[s];return o};n.__esModule=!0;var s=t(0),i=function(){function e(){}return e.prototype.newSession=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(n){return s.db.collection("sessions").doc(e.id).set({isLive:!0,stock:e.stockName,timestamp:s.firebase.firestore.FieldValue.serverTimestamp(),creator:s.auth.currentUser.uid}).catch((function(e){console.log(e),alert("There was an error: view console")})),s.db.collection("users").doc(s.auth.currentUser.uid).update({currentSession:e.id,occupiedAsAdmin:!0}),s.db.collection("rankings").doc(e.id).set({}),[2]}))}))},e.prototype.endSession=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(n){return s.db.collection("rankings").doc(e.id).get().then((function(n){var t=Object.keys(n.data()).sort((function(e,t){return n.data()[t]-n.data()[e]}));s.db.collection("sessions").doc(e.id).update({isLive:!1,winner:t[0]}).catch((function(e){console.log(e),alert("There was an error: view console")}))})),s.db.collection("users").where("currentSession","==",e.id).get().then((function(e){e.forEach((function(e){s.db.collection("users").doc(e.id).update({currentSession:"",canAddValues:!1})}))})).catch((function(e){console.log(e),alert("There was an error: view console")})),s.db.collection("users").doc(s.auth.currentUser.uid).update({occupiedAsAdmin:!1}).catch((function(e){console.log(e),alert("There was an error: view console")})),[2]}))}))},e.prototype.updateIndividualResults=function(e,n){return o(this,void 0,void 0,(function(){var t;return r(this,(function(o){return t={},[2,new Promise((function(o){Array.from(e).forEach((function(r){s.db.collection("users").doc(r).update({canAddValues:!0}).then((function(){return console.log("successfully updated user: "+r)})).catch((function(e){return console.log(e)})),s.db.collection("valuesOfUsers").where("author","==",r).where("ofSession","==",localStorage.currentSessionOfAdmin).get().then((function(i){if(i.docs[0]&&i.docs[0].data().value<=10&&i.docs[0].data().value>=-10){var c=i.docs[0].data().value,u=c*n==-0?0:c*n;s.db.collection("users").doc(r).get().then((function(n){var r,i=function(e){var n=e.data().currentSession;return(e.data()[n]?e.data()[n]:0)+u}(n),c=((r={})[n.data().currentSession]=i,r);s.db.collection("users").doc(n.id).update(c).then((function(){return console.group("done")})).catch((function(e){return console.log(e)})),t[n.data().username]=i,Object.keys(t).length===a(e).length&&o(t)}))}})).catch((function(e){return console.log(e)}))}))}))]}))}))},e.prototype.updateRanking=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(n){return s.db.collection("rankings").doc(localStorage.currentSessionOfAdmin).update(e),[2]}))}))},e.prototype.joinGame=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(n){return e.canAddValues?s.db.collection("users").doc(s.auth.currentUser.uid).update({currentSession:e.session,occupiedAsAdmin:!1}).catch((function(e){console.log(e),alert("There was an error: view console")})):s.db.collection("users").doc(s.auth.currentUser.uid).update({currentSession:e.session,occupiedAsAdmin:!1,canAddValues:!1}).catch((function(e){console.log(e),alert("There was an error: view console")})),[2]}))}))},e.prototype.addUserValue=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(n){return console.log(e.id),e.value<-11||e.value>11?(alert("Please make sure that the value you set is between -10 and 10."),console.log(e.value)):s.db.collection("valuesOfUsers").where("ofSession","==",e.id).where("author","==",s.auth.currentUser.uid).get().then((function(n){n.docs[0]?s.db.collection("valuesOfUsers").doc(n.docs[0].id).update({ofSession:e.id,value:e.value}):(console.log("justJoined"),s.db.collection("valuesOfUsers").add({ofSession:e.id,value:e.value,author:s.auth.currentUser.uid}).catch((function(e){return console.log(e)})))})).catch((function(e){return console.log(e)})),[2]}))}))},e.prototype.createStockValueIdsArray=function(e,n){return o(this,void 0,void 0,(function(){var t;return r(this,(function(o){return t=[],e.docs.forEach((function(e){t.push({value:e.data().value})})),n(t),[2]}))}))},e.prototype.disable=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(n){return s.db.collection("users").doc(e).update({canAddValues:!1}),[2]}))}))},e}();n.default=i}]);